(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{4409:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(2085)}])},2085:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return f}});var i=n(7458);n(3595),n(6004),n(4397),n(1287),n(8880),n(7654),n(8308),n(3067),n(9650),n(8078),n(3211),n(5657);var o=n(8194),c=n(2983),a=n(189);let r={viewer:0,visited:0},s=async t=>{try{let{statusCode:t,data:e}=await fetch("/api/public/viewer",{method:"GET"}).then(t=>t.json());return 233===t?r:e}catch(t){throw console.log(t),t}},u=async t=>{let e=window.localStorage.getItem("visited"),n=window.localStorage.getItem("visited-".concat(t));e||window.localStorage.setItem("visited","true"),n||window.localStorage.setItem("visited-".concat(t),"true");try{let{statusCode:t,data:i}=await fetch("/api/public/viewer?isNew=".concat(!e,"&isNewByPath=").concat(!n),{method:"POST"}).then(t=>t.json());return 233===t?r:i}catch(t){throw console.log(t),t}};var l=n(4437),w=n.n(l),f=function(t){let{Component:e,pageProps:n}=t,{current:r}=(0,c.useRef)({hasInit:!1}),[l,f]=(0,c.useState)({viewer:0,visited:0}),d=(0,a.useRouter)(),v=(0,c.useCallback)(async t=>{let e=window.location.pathname;if(window.localStorage.getItem("noViewer")){let{viewer:t,visited:n}=await s(e);f({...l,viewer:t,visited:n});return}{console.log("[更新访客]",t,e);let{viewer:n,visited:i}=await u(e);f({...l,viewer:n,visited:i})}},[l,f]),h=(t,e)=>{let{shallow:n}=e;v("页面跳转")};return(0,c.useEffect)(()=>{r.hasInit||(r.hasInit=!0,v("初始化"),d.events.on("routeChangeComplete",h))},[r,v]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w(),{children:(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, user-scalable=no"})}),(0,i.jsx)(o.k.Provider,{value:{state:l,setState:f},children:(0,i.jsx)(e,{...n})})]})}},8194:function(t,e,n){"use strict";n.d(e,{k:function(){return o}});var i=n(2983);let o=i.createContext({state:{viewer:0,visited:0},setState:t=>{}})},3211:function(){},8078:function(){},9650:function(){},8880:function(){},3595:function(){},8308:function(){},3067:function(){},6004:function(){},7654:function(){},4397:function(){},1287:function(){},5657:function(){},4437:function(t,e,n){t.exports=n(5987)},189:function(t,e,n){t.exports=n(4557)}},function(t){var e=function(e){return t(t.s=e)};t.O(0,[774,179],function(){return e(4409),e(4557)}),_N_E=t.O()}]);